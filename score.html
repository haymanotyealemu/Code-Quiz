<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./style.css">
    <title>High Scores</title>
</head>
<body>
    <header></header>
    <section id="main-content">
        <div id="container">
            <h1>High Scores:</h1>
            <textarea readonly rows="50" cols="50" id="texarea">
            </textarea>
            <a href="index.html"><input type="submit" id="back" class="button" value="Go Back"></a>
            <a href="#"><input type="submit" id="clear" class="button" value="Clear Highscore"></a>
        
        </div>  
    </section>   
    
    <!--here we write the script for our page-->
    <script>
        // DOM manipulation
        var clearBtn = document.getElementById("clear");
        var gobackBtn = document.getElementById("Goback");
        var textArea = document.getElementById("texarea");

        //player is where I store the objects from local storage
        var player={
                    name:"",        //player name
                    score:0,        //player score
        }; 

        var maxPlayer=[]             //This array holds the players with max store
        var maxScore=0;
        texarea.innerHTML="";
        player=JSON.parse(localStorage.getItem("competitor")); //get the player from local storage and store it in array player

        function find(e){ //finds the index of player e in the player list
            for (var j=0;j<player.length;j++){
                if ((player[j].name===e.name) && (player[j].score===e.score)){
                    return j;
                }
            }

        }
        
        function findMax(player){  //finds the players with max scores
            for (var i=0;i<player.length;i++){
                if(player[i].score>=maxScore){
                    if (player[i].score==maxScore){
                        max.push(player[i]);
                    }
                    else{
                        maxScore=player[i].score;
                        maxPlayer=[];
                        maxPlayer.push(player[i]) ;  
                    }       
                }    
            }     
            
            for (var i=0;i<maxPlayer.length;i++){
                texarea.innerHTML+=maxPlayer[i].name+":"+maxPlayer[i].score+"\n";  
            }
        }

        findMax(player);
        //When clear button is clicked the players with max score are removed from local storage. If there are still players, the max score
        //of remaining players is shown on the page.
        clearBtn.addEventListener("click",function(){
            
                for(var i=0;i<maxPlayer.length;i++){
                    var indexf=find(maxPlayer[i]);
                    player.splice(indexf,1);
                    localStorage.setItem("",JSON.stringify(player));
                    
                }

                texarea.innerHTML="";
                if (player.length>0){
                    maxPlayer=[];
                    maxScore=0;
                    findMax(player);
                }          
                
        
        });
        //when back button is clicked the updated player list is pushed to the storage
        gobackBtn.addEventListener("click",function(){
            localStorage.setItem("competitor",JSON.stringify(player));
        });

    </script>
</body>
</html>